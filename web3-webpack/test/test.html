<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script src="../build/web3.min.js"></script>
</head>
<body>

<script>

    "use strict";

    const deploy = {
        "abi": [
            {
                "constant": false,
                "inputs": [
                    {
                        "name": "accepted",
                        "type": "bool"
                    }
                ],
                "name": "approve",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getName",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getDescription",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getStatus",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint8"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "submit",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getDeveloper",
                "outputs": [
                    {
                        "name": "",
                        "type": "address"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getRequirements",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getFund",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "getFounder",
                "outputs": [
                    {
                        "name": "",
                        "type": "address"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "setDeveloper",
                "outputs": [],
                "payable": true,
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "name": "_name",
                        "type": "string"
                    },
                    {
                        "name": "_requirements",
                        "type": "string"
                    },
                    {
                        "name": "_description",
                        "type": "string"
                    }
                ],
                "payable": true,
                "stateMutability": "payable",
                "type": "constructor"
            },
            {
                "payable": true,
                "stateMutability": "payable",
                "type": "fallback"
            }
        ],
        "bytecode": "0x60806040526040516109473803806109478339810180604052606081101561002657600080fd5b81019080805164010000000081111561003e57600080fd5b8201602081018481111561005157600080fd5b815164010000000081118282018710171561006b57600080fd5b5050929190602001805164010000000081111561008757600080fd5b8201602081018481111561009a57600080fd5b81516401000000008111828201871017156100b457600080fd5b505092919060200180516401000000008111156100d057600080fd5b820160208101848111156100e357600080fd5b81516401000000008111828201871017156100fd57600080fd5b50508551909350610117925060009150602086019061016a565b50815161012b90600190602085019061016a565b50805161013f90600290602084019061016a565b5050600380546001600160a01b03191633179055505060048054600160a01b60ff0219169055610205565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106101ab57805160ff19168380011785556101d8565b828001600101855582156101d8579182015b828111156101d85782518255916020019190600101906101bd565b506101e49291506101e8565b5090565b61020291905b808211156101e457600081556001016101ee565b90565b610733806102146000396000f3fe6080604052600436106100915760003560e01c80637a444072116100595780637a444072146101ac5780637ae42ff9146101dd5780638edd6eb6146101f2578063946bcc3014610219578063aa1443bd1461022e57610091565b806309b67f8e1461009357806317d7de7c146100bf5780631a092541146101495780634e69d5601461015e5780635bcb2fc614610197575b005b34801561009f57600080fd5b50610091600480360360208110156100b657600080fd5b50351515610236565b3480156100cb57600080fd5b506100d4610403565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561010e5781810151838201526020016100f6565b50505050905090810190601f16801561013b5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561015557600080fd5b506100d4610499565b34801561016a57600080fd5b506101736104f7565b6040518082600381111561018357fe5b60ff16815260200191505060405180910390f35b3480156101a357600080fd5b50610091610507565b3480156101b857600080fd5b506101c1610589565b604080516001600160a01b039092168252519081900360200190f35b3480156101e957600080fd5b506100d4610598565b3480156101fe57600080fd5b506102076105f8565b60408051918252519081900360200190f35b34801561022557600080fd5b506101c16105fd565b61009161060c565b6003546001600160a01b031633146102985760408051600160e51b62461bcd02815260206004820152600d60248201527f4f6e6c7920666f756e6465722100000000000000000000000000000000000000604482015290519081900360640190fd5b6002600454600160a01b900460ff1660038111156102b257fe5b146103075760408051600160e51b62461bcd02815260206004820152601360248201527f4e6f7468696e672069732070656e64696e672100000000000000000000000000604482015290519081900360640190fd5b80156103e957600460009054906101000a90046001600160a01b03166001600160a01b03166108fc306001600160a01b0316638edd6eb66040518163ffffffff1660e01b815260040160206040518083038186803b15801561036857600080fd5b505afa15801561037c573d6000803e3d6000fd5b505050506040513d602081101561039257600080fd5b50516040518115909202916000818181858888f193505050501580156103bc573d6000803e3d6000fd5b5060048054600160a01b60ff02191674030000000000000000000000000000000000000000179055610400565b60048054600160a01b60ff021916600160a01b1790555b50565b60008054604080516020601f600260001961010060018816150201909516949094049384018190048102820181019092528281526060939092909183018282801561048f5780601f106104645761010080835404028352916020019161048f565b820191906000526020600020905b81548152906001019060200180831161047257829003601f168201915b5050505050905090565b60028054604080516020601f600019610100600187161502019094168590049384018190048102820181019092528281526060939092909183018282801561048f5780601f106104645761010080835404028352916020019161048f565b600454600160a01b900460ff1690565b6004546001600160a01b031633146105695760408051600160e51b62461bcd02815260206004820152600f60248201527f4f6e6c7920646576656c6f706572210000000000000000000000000000000000604482015290519081900360640190fd5b6004805460029190600160a01b60ff021916600160a01b835b0217905550565b6004546001600160a01b031690565b60018054604080516020601f6002600019610100878916150201909516949094049384018190048102820181019092528281526060939092909183018282801561048f5780601f106104645761010080835404028352916020019161048f565b303190565b6003546001600160a01b031690565b6000600454600160a01b900460ff16600381111561062657fe5b1461067b5760408051600160e51b62461bcd02815260206004820152601660248201527f446576656c6f70657220616c7265616479207365742100000000000000000000604482015290519081900360640190fd5b670de0b6b3a76400003410156106db5760408051600160e51b62461bcd02815260206004820152601e60248201527f506c656173652073656e64206f6e65204574686572206465706f736974210000604482015290519081900360640190fd5b600480546001600160a01b031916331780825560019190600160a01b60ff021916600160a01b8361058256fea165627a7a72305820f829c5502f27bb5c15c33e0bd5b1da4e3cecc053fe9e6075930c7d63c0670f1f0029"
    };

    const options = {
        transactionConfirmationBlocks: 1,
        transactionBlockTimeout: 5,
        transactionPollingTimeout: 480
    };

    //const web3 = new Web3 (window ['ethereum'], null, options);
    //const web3 = new Web3 (window ['ethereum']);
    //const web3 = new Web3('https://admin:un21n77w@vm-2d05.inf.h-brs.de/geth1');

    console.log (web3.version);

    //const contract = new web3.eth.Contract (deploy.abi, "0xd3fc95065c0b5dc2ecb3cfb07425a95a9aa721ed");
    const contract = new web3.eth.Contract (deploy.abi);

    //const keystore = '{"address":"5fba9fd7abdcba62777d27366d4c47f5e3538143","crypto":{"cipher":"aes-128-ctr","ciphertext":"e0ce3645dd62d3757c587e0221a161b98aa8bf4459e1a6026b8becdb4422876c","cipherparams":{"iv":"a6a0f1a18752344c84c75e6a0cb390d3"},"kdf":"scrypt","kdfparams":{"dklen":32,"n":262144,"p":1,"r":8,"salt":"0cdc6676e48914774e7cdd341265928bcb33e5947b5e9a3ef2a4134e6941df0e"},"mac":"d5c33fc46d0ae1c40d36ccd8dc699f2a33be1eff500ea857f6a032ee2025acd9"},"id":"78de512b-a2b3-4701-9b7c-4599548a1879","version":3}';
    //console.log (keystore);

    //const decryptedAccount = web3.eth.accounts.decrypt(keystore, '1234abcd');
    //console.log (decryptedAccount);

    //const account = web3.eth.accounts.privateKeyToAccount ('0x1d46e058379b124789e4a563f5fa39e00c36303b3173c5a9e5d4876f3497b173');

    /*console.log (account);

    const rawTransaction = {
        "from": "0x5fba9fd7abdcba62777d27366d4c47f5e3538143",
        "to": "0xAb1b08151ECfE6F2bA4018F5b096A9a26F315D8f",
        "value": web3.utils.toHex(web3.utils.toWei("0.1", "ether")),
        "gas": 200000,
        "chainId": 32
    };

    web3.eth.accounts.signTransaction({
        to: '0xAb1b08151ECfE6F2bA4018F5b096A9a26F315D8f',
        value: web3.utils.toHex(web3.utils.toWei("0.1", "ether")),
        gas: 2000000
    }, '0x1d46e058379b124789e4a563f5fa39e00c36303b3173c5a9e5d4876f3497b173')
        .then(console.log);*/


    window ['ethereum'].enable()
        .then (accounts => {

            contract.deploy({
                data: deploy.bytecode,
                arguments: [
                    "Component name",
                    "req",
                    "sdf"
                ]
            })
            .send ({
                from: accounts [0]
            })
            .on ('error',           console.error)
            .on ('transactionHash', console.log)
            .on ('receipt',         console.log);

        })
        .catch (console.error);

    /*window ['ethereum']
        .on ('accountsChanged', accounts => {
            console.log (accounts);
        });*/

    /*contract.methods ['getRequirements']()
        .call()
        .then (JSON.parse)
            .then (console.log);*/

</script>

</body>
</html>